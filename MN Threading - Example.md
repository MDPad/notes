---
Theme: "[[Go - Scheduler]]"
---
**M:N Scheduler** — это механизм, который распределяет \( M \) горутин между \( N \) потоками операционной системы, обеспечивая эффективное выполнение задач и минимизацию накладных расходов.

---
![Simple M:N Scheduler](mn_scheduler.png)

## Основные элементы

1. **Горутины (G):**
   - Легковесные потоки, реализуемые в пространстве пользователя.
   - Используют небольшой стек (2-4 КБ).

2. **Потоки ОС (Threads):**
   - Реальные системные потоки, на которых выполняются горутины.
   - Поток может выполнять только одну горутину в момент времени.

3. **Глобальная очередь (Run Queue):**
   - Хранит **runnable goroutines** (готовые к выполнению горутины).
   - Планировщик выбирает из этой очереди горутины для назначения на потоки.

4. **Mutex:**
   - Используется для синхронизации доступа между потоками при выборе горутин из очереди.

5. **Выполняемые горутины (Running Goroutines):**
   - Горутины, которые в текущий момент выполняются на потоках.

---

## Принципы работы

1. **Добавление в очередь:**
   - Новые горутины помещаются в **глобальную очередь** (Run Queue) задач.

2. **Назначение потокам:**
   - **Mutex** обеспечивает синхронизированный доступ к очереди.  
   - Потоки выбирают горутины из глобальной очереди и начинают их выполнение.

3. **Выполнение горутин:**
   - Один поток выполняет одну горутину в момент времени.
   - Горутина продолжает выполнение, пока не завершится или не будет заблокирована.

4. **Обработка блокировок:**
   - Если горутина блокируется, поток может выбрать следующую готовую горутину из очереди.

---

## Преимущества

- **Эффективное использование ресурсов:** один поток может обслуживать несколько горутин.
- **Масштабируемость:** поддержка тысяч или миллионов горутин.
- **Простота управления:** автоматическое переключение задач планировщиком.

---

## Недостатки

- **Синхронизация:** доступ к глобальной очереди требует использования **mutex**, что может стать узким местом.
- **Сложность реализации:** управление блокировками и планирование задач требует сложных алгоритмов.
- **Недетерминизм:** порядок выполнения горутин непредсказуем.

