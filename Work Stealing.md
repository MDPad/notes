---
Theme: "[[Go - Scheduler]]"
---
Стратегия распределения задач, при которой потоки (goroutines), оставшиеся без работы, «крадут» задачи из очередей других потоков. 

---
## Как работает?

1. **Локальные очереди задач:**
   - Каждый поток (P) имеет свою локальную очередь goroutines.
   - Поток выполняет задачи из своей очереди по принципу LIFO (Last In, First Out), чтобы улучшить локальность данных и снизить накладные расходы на доступ к памяти.

2. **Кража задач:**
   - Если локальная очередь потока пуста, поток начинает искать задачи в очередях других потоков.
   - Поток выбирает случайный другой поток (P) для кражи задач, чтобы равномерно распределить нагрузку и избегать конфликтов.
   - Задачи крадутся с начала очереди другого потока (FIFO). Это помогает сохранить локальность данных для задач, оставшихся в исходной очереди.
   - Обычно крадется партия задач (например, половина очереди), чтобы уменьшить накладные расходы на частую кражу.

---
## Преимущества Work Stealing

- **Эффективное использование ресурсов:**
  - Потоки не простаивают без работы, если в системе есть доступные задачи.
- **Масштабируемость:**
  - Подходит для систем с большим количеством потоков и процессорных ядер.
- **Улучшение локальности данных:**
  - Задачи сначала выполняются из локальной очереди, что снижает накладные расходы на доступ к памяти.

---
## Недостатки Work Stealing

- **Накладные расходы:**
  - Кража задач требует синхронизации и добавляет накладные расходы.
- **Сложность реализации:**
  - Планировщик должен эффективно управлять локальными и глобальными очередями, предотвращая конфликты.
- **Непредсказуемость производительности:**
  - Динамическое перераспределение задач может приводить к скачкам задержек.

---
## Сравнение Work Stealing и Work Sharing

| **Критерий**                    | **Work Stealing**                               | **Work Sharing**                                     |
| ------------------------------- | ----------------------------------------------- | ---------------------------------------------------- |
| **Основной принцип**            | Потоки крадут задачи, если их очередь пуста     | Потоки передают задачи, если их очередь перегружена  |
| **Инициатор перераспределения** | Поток, оставшийся без работы                    | Поток, имеющий избыток задач                         |
| **Распределение задач**         | Динамическое: задачи крадутся из чужих очередей | Динамическое: задачи отдаются из собственной очереди |
| **Использование ресурсов**      | Эффективное за счет перераспределения задач     | Эффективное, если потоки передают задачи вовремя     |
| **Накладные расходы**           | Высокие на кражу задач                          | Высокие на синхронизацию и управление очередями      |
| **Подходящая нагрузка**         | Непредсказуемая, с разной длительностью задач   | Предсказуемая, с равномерной загрузкой               |
| **Сложность реализации**        | Высокая (локальные и глобальные очереди)        | Умеренная (требуется контроль за передачей задач)    |
